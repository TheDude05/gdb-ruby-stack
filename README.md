This code was based on the work in this Gist: https://gist.github.com/csfrancis/11376304
